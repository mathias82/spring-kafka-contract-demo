<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />

    <title>Kafka Schema Evolution Demo (Avro) | Spring Kafka Contract Enforcement</title>

    <meta name="description"
          content="Interactive Kafka Schema Evolution demo using Avro. Learn compatibility rules, schema contracts and how Spring Kafka applications enforce schema validation before producing data." />

    <meta name="keywords"
          content="Kafka Schema Registry, Avro Schema Evolution, Spring Kafka, Schema Compatibility, Kafka Contracts, Confluent Schema Registry" />

    <meta name="author" content="Mathias Stavrou" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Open Graph (GitHub / LinkedIn preview) -->
    <meta property="og:title" content="Kafka Schema Evolution Demo (Avro)" />
    <meta property="og:description"
          content="Visual explanation of Kafka schema evolution, compatibility rules and contract enforcement using Spring Kafka." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://mathias82.github.io/spring-kafka-contract-demo/" />

    <style>
        body {
          font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
          margin: 40px;
          background: #fafafa;
          color: #333;
        }

        h1, h2, h3 {
          margin-top: 1.5em;
        }

        .container {
          max-width: 1100px;
          margin: auto;
        }

        .grid {
          display: grid;
          grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
          gap: 20px;
          margin-top: 20px;
        }

        .card {
          background: white;
          border-radius: 8px;
          padding: 20px;
          box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        pre {
          background: #f4f4f4;
          padding: 12px;
          border-radius: 6px;
          overflow-x: auto;
          font-size: 0.9em;
        }

        .tag {
          display: inline-block;
          padding: 4px 10px;
          font-size: 0.8em;
          border-radius: 20px;
          margin-bottom: 8px;
        }

        .ok { background: #e6fffa; color: #065f46; }
        .warn { background: #fff7ed; color: #92400e; }
        .bad { background: #fee2e2; color: #991b1b; }

        .controls {
          margin: 20px 0;
          display: flex;
          flex-wrap: wrap;
          gap: 10px;
          align-items: center;
        }

        .result {
          margin-top: 20px;
          padding: 15px;
          border-radius: 6px;
          background: #f9fafb;
          border-left: 5px solid #999;
        }

        footer {
          margin-top: 50px;
          font-size: 0.9em;
          color: #666;
        }
    </style>
</head>

<body>
<div class="container">

    <h1>Kafka Schema Evolution Demo (Avro)</h1>

    <p>
        This interactive demo explains <strong>schema evolution</strong>,
        <strong>compatibility rules</strong> and
        <strong>contract enforcement</strong> in Apache Kafka using Avro schemas.
    </p>

    <p>
        It demonstrates how <strong>Spring Kafka applications</strong> should validate schemas
        <strong>before producing data</strong>, preventing breaking changes from reaching production.
    </p>

    <h2>Why Schema Contracts Matter</h2>

    <p>
        Kafka messages are <strong>binary</strong>. Without a schema, data is meaningless.
        Schema Registry acts as a <strong>central contract authority</strong> between producers and consumers.
    </p>

    <ul>
        <li>Producers must follow an agreed contract</li>
        <li>Consumers rely on backward/forward compatibility</li>
        <li>Breaking changes can crash applications at runtime</li>
    </ul>

    <p>
        This demo shows how these rules apply in practice.
    </p>

    <h2>Schema Compatibility Rules (Avro)</h2>

    <ul>
        <li><strong>BACKWARD</strong>: New consumers can read old data</li>
        <li><strong>FORWARD</strong>: Old consumers can read new data</li>
        <li><strong>FULL</strong>: Both directions are supported</li>
    </ul>

    <h2>Interactive Schema Evolution Demo</h2>

    <div class="controls">
        <label>Compatibility mode:
            <select id="mode">
                <option value="BACKWARD">BACKWARD</option>
                <option value="FORWARD">FORWARD</option>
                <option value="FULL">FULL</option>
            </select>
        </label>

        <label>Existing schema:
            <select id="current">
                <option value="v1">v1</option>
                <option value="v2">v2</option>
                <option value="v3">v3</option>
            </select>
        </label>

        <label>New schema:
            <select id="next">
                <option value="v1">v1</option>
                <option value="v2">v2</option>
                <option value="v3">v3</option>
            </select>
        </label>

        <button onclick="runCheck()">Run compatibility check</button>
    </div>

    <div class="grid">
        <div class="card">
            <span class="tag ok">Schema v1 ‚Äì Baseline</span>
            <pre>
{
  "type": "record",
  "name": "OrderEvent",
  "fields": [
    { "name": "orderId", "type": "string" },
    { "name": "amount", "type": "double" }
  ]
}
      </pre>
            <p>Initial contract used by all consumers.</p>
        </div>

        <div class="card">
            <span class="tag warn">Schema v2 ‚Äì Compatible</span>
            <pre>
{
  "type": "record",
  "name": "OrderEvent",
  "fields": [
    { "name": "orderId", "type": "string" },
    { "name": "amount", "type": "double" },
    { "name": "currency", "type": ["null", "string"] }
  ]
}
      </pre>
            <p>Adds optional field ‚Üí safe evolution.</p>
        </div>

        <div class="card">
            <span class="tag bad">Schema v3 ‚Äì Breaking</span>
            <pre>
{
  "type": "record",
  "name": "OrderEvent",
  "fields": [
    { "name": "orderId", "type": "string" }
  ]
}
      </pre>
            <p>Removes required field ‚Üí breaking change.</p>
        </div>
    </div>

    <div id="result" class="result">
        Select schemas and run the compatibility check.
    </div>

    <h2>How This Applies to Spring Kafka</h2>

    <p>
        In real applications, this logic is enforced automatically by
        <strong>Schema Registry</strong> and by tools like:
    </p>

    <p>
        üëâ <a href="https://github.com/mathias82/spring-kafka-contract-starter" target="_blank">
        spring-kafka-contract-starter
    </a>
    </p>

    <p>
        With contract enforcement enabled:
    </p>

    <ul>
        <li>Applications fail fast at startup</li>
        <li>Breaking schemas are rejected before data is produced</li>
        <li>Production incidents are avoided</li>
    </ul>

    <footer>
        <p>
            Created by <strong>Mathias Stavrou</strong> ‚Ä¢
            Apache Kafka ‚Ä¢ Avro ‚Ä¢ Schema Registry ‚Ä¢ Spring Kafka
        </p>
    </footer>

</div>

<script>
    function runCheck() {
      const current = document.getElementById("current").value;
      const next = document.getElementById("next").value;
      const mode = document.getElementById("mode").value;
      const result = document.getElementById("result");

      if (current === "v1" && next === "v2") {
        result.innerHTML =
          "<strong>Result: ‚úÖ COMPATIBLE</strong><br/>Optional field added. Safe for " + mode + " compatibility.";
        result.style.borderLeftColor = "#16a34a";
      } else if (next === "v3" && current !== "v3") {
        result.innerHTML =
          "<strong>Result: ‚ùå INCOMPATIBLE</strong><br/>Required field removed. Application startup should fail.";
        result.style.borderLeftColor = "#dc2626";
      } else {
        result.innerHTML =
          "<strong>Result:</strong> No change or same schema selected.";
        result.style.borderLeftColor = "#999";
      }
    }
</script>

</body>
</html>